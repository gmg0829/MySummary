##简介
Mesos 可以将整个数据中心的资源（包括 CPU、内存、存储、网络等）进行抽象和调度，使得多个应用同时运行在集群中分享资源，并无需关心资源的物理分布情况。

Mesos 拥有许多引人注目的特性，包括：
- 支持数万个节点的大规模场景（Apple、Twitter、eBay 等公司实践）；
- 支持多种应用框架，包括 Marathon、Singularity、Aurora 等；
- 支持 HA（基于 ZooKeeper 实现）；
- 支持 Docker、LXC 等容器机制进行任务隔离；
- 提供了多个流行语言的 API，包括 Python、Java、C++ 等；
- 自带了简洁易用的 WebUI，方便用户直接进行操作。

### 安装
主：192.168.124.133

从：192.168.124.128

1、添加 mesos的yum源
```
rpm -Uvh http://repos.mesosphere.io/el/7/noarch/RPMS/mesosphere-el-repo-7-2.noarch.rpm
```
2、安装 Mesos
```
yum -y install mesos marathon mesosphere-zookeeper
```
marathon如果安装失败可以使用镜像启动
```
docker run -d -p 8080:8080 mesosphere/marathon:v1.3.6 --master zk://172.17.0.3:2181/mesos --zk zk://172.17.0.3:2181/marathon
```
3、配置zookeeper
```
touch /var/lib/zookeeper/myid
echo 1 > /var/lib/zookeeper/myid
```
4、在配置文件/etc/zookeeper/conf/zoo.cfg中加入下面内容
```
echo "server.1=192.168.124.133:2888:3888">>/etc/zookeeper/conf/zoo.cfg
```
5、配置mesos
```
echo "zk://192.168.124.133:2181/mesos">/etc/mesos/zk
```
6、配置marathon
```
echo $hostname>/etc/mesos-master/hostname
mkdir -p /etc/marathon/conf/
cp /etc/mesos-master/hostname /etc/marathon/conf
```
```
cp /etc/mesos/zk /etc/marathon/conf/master
cp /etc/marathon/conf/master /etc/marathon/conf/zk
echo "zk://192.168.124.133:2181/marathon">/etc/marathon/conf/zk
```
7、启动zookeeper mesos-master marathon
```
systemctl start zookeeper 
systemctl start mesos-master
systemctl start marathon
systemctl disable mesos-slave
```
8、 安装Mesos Slave
```
yum -y install mesos
```
配置master信息
```
echo "zk://192.168.124.133:2181/mesos">/etc/mesos/zk
echo $hostname >/etc/mesos-slave/hostname
```
创建work_dir
```
rm -rf /etc/mesos-slave/work_dir && mkdir /etc/mesos-slave/work_dir/provisioner -p
```
9、启动mesos-slave
```
systemctl start  mesos-slave 
systemctl enable  mesos-slave
systemctl disable mesos-master
```
实验过程中，slave启动失败了，选择用命令运行slave
```
nohup mesos-slave --master=zk://192.168.124.133:2181/mesos --work_dir=/etc/mesos-slave/work_dir >mesos-slave.log 2>&1 &
或
mesos-slave --master=zk://192.168.124.133:2181/mesos  --work_dir=/etc/mesos-slave/work_dir
```
10、访问Mesos
- mesos地址：http://192.168.124.133:5050/
![](https://github.com/gmg0829/Img/blob/master/mesos/mesos-index.png?raw=true)
- marathon地址：http://192.168.124.133:8080/
![](https://github.com/gmg0829/Img/blob/master/mesos/marthon.png?raw=true)
- 查看 slave
![](https://github.com/gmg0829/Img/blob/master/mesos/mesos-agent.png?raw=true)




{
  "id":"nginx",
  "cpus":0.2,
  "mem":20.0,
  "instances": 1,
  "constraints": [["hostname", "UNIQUE",""]],
  "container": {
  "type":"DOCKER",
  "docker": {
     "image": "daocloud.io/nginx",
     "network": "BRIDGE",
     "portMappings": [
        {"containerPort": 80, "hostPort": 0,"servicePort": 0, "protocol": "tcp" }
      ]
    }
  }
}

systemctl


curl -X POST -H "Content-Type: application/json" http://192.168.124.133:8080/v2/apps -d@busybox-demo.json

{"id":"/busybox-demo","cmd":"while sleep 10; do date -u +%T; done","args":null,"user":null,"env":{},"instances":2,"cpus":0.5,"mem":256,"disk":0,"gpus":0,"executor":"","constraints":[],"uris":[],"fetch":[],"storeUrls":[],"backoffSeconds":1,"backoffFactor":1.15,"maxLaunchDelaySeconds":3600,"container":{"type":"DOCKER","volumes":[],"docker":{"image":"busybox","network":null,"portMappings":[],"privileged":false,"parameters":[],"forcePullImage":false}},"healthChecks":[],"readinessChecks":[],"dependencies":[],"upgradeStrategy":{"minimumHealthCapacity":1,"maximumOverCapacity":1},"labels":{},"ipAddress":null,"version":"2017-05-03T03:29:46.941Z","residency":null,"secrets":{},"taskKillGracePeriodSeconds":null,"unreachableStrategy":{"inactiveAfterSeconds":300,"expungeAfterSeconds":600},"killSelection":"YOUNGEST_FIRST","ports":[0],"portDefinitions":[{"port":0,"protocol":"tcp","name":"default","labels":{}}],"requirePorts":false,"tasksStaged":0,"tasksRunning":0,"tasksHealthy":0,"tasksUnhealthy":0,"deployments":[{"id":"2f25526a-7641-4326-bd63-26eb69364838"}],"tasks":[]}
